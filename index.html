<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>sObjects.js by jgalilee</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>sObjects.js</h1>
          <h2></h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/jgalilee/sObjects.js/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/jgalilee/sObjects.js/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/jgalilee/sObjects.js" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>sObjects.js</h1>

<p>Currently there exists very little documentation about how to use the new Force.com canvas javascript library. This library hopes to remove the difficulty of locating these resources and to provide a friendly wrapper for the existing library making it easier to use and bringing it inline with modern javascript libraries.</p>

<h2>Building</h2>

<p>Building the sObjects.js library requires nodejs, npm and a global installation of the npm jake package.</p>

<p>git clone this library and install the node dependencies.</p>

<div class="highlight"><pre>sudo npm install dependencies
</pre></div>

<p>To build the sObjects.js library run jake</p>

<div class="highlight"><pre>jake
</pre></div>

<p>The sobjects.min.js file will now be in the current directory.</p>

<h2>Installation</h2>

<p>Installing the library into a Ruby on Rails or Java application is as easy as adding it to the javascript assets, and making sure that is included correctly.</p>

<h2>Usage</h2>

<p>Detailed usage can be found at the <a href="https://github.com/jgalilee/sObjects.js/wiki">sObjects Wiki.</a></p>

<h2>Overview</h2>

<p>Using the sObjects library is simple. Examples for the Force.com canvas require you to setup the request object as follows.</p>

<div class="highlight"><pre><span class="nx">Sfdc</span><span class="p">.</span><span class="nx">canvas</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'&lt;%=signedRequestJson%&gt;'</span><span class="p">);</span>
  <span class="nx">Sfdc</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">oauth</span><span class="p">.</span><span class="nx">token</span><span class="p">(</span><span class="nx">sr</span><span class="p">.</span><span class="nx">oauthToken</span><span class="p">);</span>

  <span class="c1">// Code using the canvas goes here.</span>

<span class="p">});</span>
</pre></div>

<p>sObjects simplifies this low level approach by providing a wrapping function. In the background sObjects will curate the data available with the Force.com canvas api and map it into a more robust and semantically enjoyable library.</p>

<div class="highlight"><pre><span class="nx">Sfdc</span><span class="p">.</span><span class="nx">canvas</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sObjects</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sObjects</span><span class="p">();</span>
  <span class="nx">sObjects</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="s1">'&lt;%= raw @canvasRequestJson %&gt;'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Code using canvas goes here.</span>
    <span class="c1">// Code using sObjects goes here.</span>

  <span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>sObjects does not mutate the existing library which can still be accessed with ...</p>

<pre><code>sObjects.getBase() // return result of var sr = JSON.parse('&lt;%=signedRequestJson%&gt;');
</code></pre>

<h3>Accessing sObjects</h3>

<p>sObjects will load all of the objects that are available in the context of the Force.com canvas. They are accessible as an attribute of sObjects where there name denotes the attribute of sObjects.</p>

<p>Example: Accounts have the name Account, so the Account sObjects is referenced with …</p>

<div class="highlight"><pre><span class="nx">sObjects</span><span class="p">.</span><span class="nx">Account</span>
</pre></div>

<p>sObjects are not loaded by default. You can force an sObject to load by calling the load method. Loading an sObject retrieves the schema for the sObject and all of its fields. It also prepares the urls required to query and update the sObject.</p>

<p>sObjects can be loaded with …</p>

<div class="highlight"><pre><span class="nx">sObjects</span><span class="p">.</span><span class="nx">Account</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'sObjects.Account.load callback'</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h3>Querying sObjects</h3>

<p>Borrowing from the rails active record and arel libraries sObjects implement their own programatic query interface for constructing SOQL queries.</p>

<p>Without sObjects querying the Id and Name fields from the Account records involves the following...</p>

<div class="highlight"><pre><span class="nx">Sfdc</span><span class="p">.</span><span class="nx">canvas</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sr</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'&lt;%=signedRequestJson%&gt;'</span><span class="p">);</span>
  <span class="nx">Sfdc</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">oauth</span><span class="p">.</span><span class="nx">token</span><span class="p">(</span><span class="nx">sr</span><span class="p">.</span><span class="nx">oauthToken</span><span class="p">);</span> <span class="c1">// Save the token</span>

  <span class="kd">var</span> <span class="nx">queryUrl</span> <span class="o">=</span> <span class="nx">sr</span><span class="p">.</span><span class="nx">instanceUrl</span> <span class="o">+</span> <span class="nx">sr</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">links</span><span class="p">.</span><span class="nx">queryUrl</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">soqlQuery</span> <span class="o">=</span> <span class="s2">"SELECT Id, Name FROM Account"</span><span class="p">;</span>

  <span class="nx">Sfdc</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="nx">queryUrl</span> <span class="o">+</span> <span class="s2">"?q="</span> <span class="o">+</span> <span class="nx">soqlQuery</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">token</span><span class="o">:</span> <span class="nx">sr</span><span class="p">.</span><span class="nx">oauthToken</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="nx">contentType</span><span class="o">:</span> <span class="s2">"application/json"</span><span class="p">,</span>
    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Found the id and name of all accounts: '</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">records</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>

</pre></div>

<p>Using sObjects is not only semantically nicer, but allows for easy construction of complex SOQL queries.</p>

<div class="highlight"><pre><span class="nx">sObjects</span><span class="p">.</span><span class="nx">Account</span><span class="p">.</span><span class="nx">find</span><span class="p">([</span><span class="s1">'Id'</span><span class="p">,</span> <span class="s1">'Name'</span><span class="p">]).</span><span class="nx">all</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Found the id and name of all accounts: '</span><span class="p">,</span> <span class="nx">records</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h4>Queries and sObject loading</h4>

<p>sObjects loads all information about sObjects available in the context that canvas app is running. They are then available as a property of sObjects. sObject queries are lazy loaded, specific information about an sObject is only retrieved when required.</p>

<p>You can force sObjects to load by calling the load function.</p>

<div class="highlight"><pre><span class="nx">sObjects</span><span class="p">.</span><span class="nx">Account</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'sObjects.Account finished loading'</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you do not want to call the load function, this will automatically be called when you do your first query.
If you chose to do this, your first query will load the sObject details and then perform the query, subsequent
queries will not call the load method.</p>

<div class="highlight"><pre>
<span class="c1">// First query</span>
<span class="nx">sObjects</span><span class="p">.</span><span class="nx">Account</span><span class="p">.</span><span class="nx">find</span><span class="p">([</span><span class="s1">'Id'</span><span class="p">,</span> <span class="s1">'Name'</span><span class="p">]).</span><span class="nx">all</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Found the id and name of all accounts in an asynchronous callback after load'</span><span class="p">,</span> <span class="nx">records</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Second query</span>
<span class="nx">sObjects</span><span class="p">.</span><span class="nx">Account</span><span class="p">.</span><span class="nx">find</span><span class="p">([</span><span class="s1">'Id'</span><span class="p">,</span> <span class="s1">'Name'</span><span class="p">]).</span><span class="nx">all</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Found the id and name of all accounts in an asynchronous callback '</span><span class="p">,</span> <span class="nx">records</span><span class="p">);</span>
<span class="p">});</span>

</pre></div>
        </section>

        <footer>
          sObjects.js is maintained by <a href="https://github.com/jgalilee">jgalilee</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>