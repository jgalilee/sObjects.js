var SOQL=function(e){this.query="";for(var t in e)this[t]=e[t];return this};SOQL.prototype._bindSyntax=function(e){return this.query+=e+" ",this},SOQL.prototype._bindValues=function(e,t){var n="";undefined===t&&(t=", ");if(undefined!==e){e=e.reverse();for(var r=e.length-1;r>=0;r--)e.length!=0&&r<e.length-1?n+=t+e[r]:n+=e[r]}return this._bindSyntax(n)},SOQL.prototype.select=function(e){return this._bindSyntax("SELECT")._bindValues(e)},SOQL.prototype.subSelect=function(e){return this._bindSyntax("(")._bindSyntax(e(new SOQL).finish())._bindSyntax(")")},SOQL.prototype.from=function(e){return this._bindSyntax("FROM")._bindSyntax(e)},SOQL.prototype.where=function(e){return this._bindSyntax("WHERE")._bindSyntax(e)},SOQL.prototype.equal=function(e){return this._bindSyntax("==")._bindSyntax(e)},SOQL.prototype.and=function(e){return this._bindSyntax("AND")._bindSyntax(e)},SOQL.prototype.or=function(e){return this._bindSyntax("OR")._bindSyntax(e)},SOQL.prototype.notEqual=function(e){return this._bindSyntax("!=")._bindSyntax(e)},SOQL.prototype.not=function(){return this._bindSyntax("NOT")},SOQL.prototype.isNull=function(e){return this._bindSyntax("IS NULL")},SOQL.prototype.isNotNull=function(e){return this._bindSyntax("IS NOT NULL")},SOQL.prototype.in=function(e){return this._bindSyntax("IN(")._bindValues(e)._bindSyntax(")")},SOQL.prototype.limit=function(e){return this._bindSyntax("LIMIT")._bindSyntax(e.toString())},SOQL.prototype.orderBy=function(e){return this._bindSyntax("ORDER BY")._bindValues(e)},SOQL.prototype.orderByAsc=function(e){return this._bindSyntax("ORDER BY ASC")._bindValues(e)},SOQL.prototype.orderByDesc=function(e){return this._bindSyntax("ORDER BY DESC")._bindValues(e)},SOQL.prototype.finish=function(e){var t=this.query;this.query="";while(t.charAt(t.length-1)===" ")t=t.substr(0,t.length-1);return t};
;
sObjectClass=function(e,t){var n=this;return n._sObjects=e,n._sObjectSchema=t,n._is={loaded:!1},n},sObjectClass.prototype._deferUnlessLoaded=function(e){var t=this;return t.is("loaded")==0?t.load(e):e(),t},sObjectClass.prototype.url=function(){return _sObjectSchema.urls.sobject},sObjectClass.prototype.is=function(e){var t=this;return t._is[e]},sObjectClass.prototype.load=function(e){var t=this;return t._sObjects.ajax({url:this._sObjectSchema.urls.describe,method:"GET",success:function(n){var r=n.payload.fields;t.fields={};for(var i=r.length-1;i>=0;i--){var s=r[i];undefined!==s.name&&(t.fields[s.name]=s)}t._is.loaded=!0,undefined!==e&&e(t)}}),t},sObjectClass.prototype.className=function(){return this._sObjectSchema.name},sObjectClass.prototype.find=function(e){var t=this,n=new SOQL({all:function(e){t._deferUnlessLoaded(function(){t._sObjects.ajax({url:t._sObjects._urls.query+"?q="+n.finish(),method:"GET",success:function(n,r){var i=[],s=n.payload.records;for(var o=s.length-1;o>=0;o--)i.push(new sObjectRecord(t,s[o]));e(i,n,r)}})})}});return n.select(e).from(this.className())},sObjectClass.prototype.build=function(e){var t=this,n=[];if(Object.prototype.toString.call(e)==="[object Array]")for(var r=e.length-1;r>=0;r--)n.push(new sObjectRecord(t,e[r]));else result=new sObjectRecord(t,e);return n},sObjectClass.prototype.create=function(e,t){var n=this;return n._sObjects.ajax({url:this.url(),method:"POST",payload:e.get(),success:function(n){e.set(n.payload),t(n)}}),e},sObjectClass.prototype.read=function(e,t){var n=this;return n._sObjects.ajax({url:e.url(),method:"GET",success:function(n){e.set(n.payload),t(n)}}),e},sObjectClass.prototype.update=function(e,t){var n=this;return n._sObjects.ajax({url:e.url(),method:"PATCH",payload:e.get(),success:function(n){e.set(n.payload),t(n)}}),e},sObjectClass.prototype.delete=function(e,t){var n=this;return n._sObjects.ajax({url:e.url(),method:"DELETE",success:function(e){t(e)}}),e};
var sObjects=function(e,t){var n=this;return n._sr=JSON.parse(e),n._oauthToken=Sfdc.canvas.oauth.token(n._sr),n._sfdcClient=Sfdc.canvas.client,n.loadUrls(function(){n.loadObjects(function(){undefined!==t&&t(n)})}),n};sObjects.prototype.ajax=function(e){var t=this,n={token:t._sr.oauthToken,method:e.method,contentType:"application/json",success:e.success};return undefined!==e.payload&&(n.data=JSON.stringify(e.payload)),Sfdc.canvas.client.ajax(e.url,n),this},sObjects.prototype.loadUrls=function(e){var t=this;t._urls={},t._baseUrl=t._sr.instanceUrl;var n=t._sr.context.links;for(var r in n)t._urls[r.substr(0,r.length-3)]=t._baseUrl+n[r];return undefined!==e&&e(),!0},sObjects.prototype.loadObjects=function(e){var t=this;return t.ajax({url:t._urls.sobject,method:"GET",success:function(n){var r=n.payload.sobjects;for(var i=r.length-1;i>=0;i--){var s=r[i];undefined!==s.name&&(t[s.name]=new sObjectClass(t,s))}undefined!==e&&e(t,n,status)}}),!0},window.sObjects=sObjects
